# 意思決定ログ: ポーリング間隔と監視方針

**日時**: 2026-02-02 00:15 JST  
**フェーズ**: Phase 3 設計レビュー  
**参加者**: まさかずさん、はせしん

---

## 議題

Phase 3 URL監視機能のポーリング設計について

---

## 背景

当初の設計（Deep Research結果）:
- ブラウザ前面時: 3秒間隔でポーリング
- その他アプリ: 10秒間隔

まさかずさんから「常時監視は厳しすぎないか」という懸念が上がった。

---

## 議論のポイント

### 1. イベント駆動 vs ポーリング

**Q**: アプリ切り替えをイベント検知して、その瞬間だけURLチェックできないか？

**A**: 
- アプリ切り替え → NSWorkspace通知で検知可能 ✅
- タブ切り替え → ブラウザ内部イベントなので検知不可 ❌

**結論**: タブ切り替えを検知するにはポーリングが必要

---

### 2. 複数ウィンドウ/ディスプレイの扱い

**Q**: 2ディスプレイでそれぞれChromeを開いている場合、両方監視する？

**A**: 
- 現状のAppleScript（`front window`）は最前面の1ウィンドウのみ取得
- 全ウィンドウ監視も技術的には可能だが実装が複雑化

**結論**: front window（アクティブウィンドウ）のみ監視
- 理由: 「今まさにダラダラ見てる」を止めたい → アクティブ操作中のみで十分
- 裏で開いてるだけなら「ダラダラ見てる」わけじゃない

---

### 3. ポーリング間隔

**Q**: 3秒は短すぎないか？省電力・メモリを気にしている

**A**: 間隔比較

| 間隔 | 1時間あたり実行回数 | 最大検知遅延 |
|------|---------------------|--------------|
| 3秒 | 1,200回 | 3秒 |
| 5秒 | 720回 | 5秒 |
| 30秒 | 120回 | 30秒 |

**結論**: 30秒間隔を採用
- 理由1: 省電力・メモリ消費を最小化（1/10の負荷）
- 理由2: 「見すぎ防止」の用途なら、最悪40秒後（検知30秒+猶予10秒）の警告で十分
- 理由3: 「一瞬見ただけ」と「ダラダラ見てる」の区別がつきやすい

---

## 最終決定

| 項目 | 決定値 | 理由 |
|------|--------|------|
| ポーリング間隔 | **30秒** | 省電力重視 |
| ブラウザ以外 | **停止** | 監視不要 |
| 監視対象 | **front windowのみ** | アクティブ操作中のみで十分 |
| 猶予時間 | 10秒（設定可能） | 既存設計を維持 |
| 繰り返し間隔 | 15秒（設定可能） | 既存設計を維持 |

---

## 今後の拡張可能性（メモ）

- ブラウザ拡張（Safari Extension / Chrome Extension）を作れば、タブ切り替えをイベント検知可能
- ただしMVPでは過剰なので見送り

---

## 変更対象ファイル

- [x] docs/phase3/SPEC.md - 非機能要件セクション
- [x] docs/phase3/TECH.md - URLMonitor設計、ポーリング設計セクション
- [ ] docs/phase3/CODE_REFERENCE.md - 数値のみ（まさかずさんが修正）
